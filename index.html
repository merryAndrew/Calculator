<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        body {
            background: #f5f7fa;
            padding: 0;
            margin: 0;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .calculator-container {
            width: 100vw;
            height: 100vh;
            background: white;
            display: flex;
            flex-direction: column;
        }
        .header {
            background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
            color: white;
            padding: 12px 15px;
            text-align: center;
            flex-shrink: 0;
        }
        h1 {
            font-size: 16px;
            font-weight: 600;
        }
        .tabs {
            display: flex;
            background: #f0f4f8;
            flex-shrink: 0;
        }
        .tab {
            flex: 1;
            padding: 10px;
            text-align: center;
            font-weight: 500;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            font-size: 13px;
        }
        .tab.active {
            background: white;
            color: #2196F3;
            border-bottom: 2px solid #2196F3;
        }
        .calculator-content {
            flex: 1;
            padding: 15px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .input-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 15px;
            flex-shrink: 0;
        }
        .input-item {
            margin-bottom: 8px;
            position: relative;
        }
        label {
            display: block;
            margin-bottom: 4px;
            color: #37474F;
            font-weight: 500;
            font-size: 12px;
        }
        .required::after {
            content: "*";
            color: #f44336;
            margin-left: 2px;
        }
        input, select {
            width: 100%;
            padding: 8px 30px 8px 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 12px;
        }
        input:focus, select:focus {
            outline: none;
            border-color: #2196F3;
        }
        .clear-btn {
            position: absolute;
            right: 8px;
            top: 70%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #999;
            font-size: 10px;
            cursor: pointer;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.2s;
        }
        .input-item input:not(:placeholder-shown) + .clear-btn {
            opacity: 1;
        }
        .result-wrap {
            background: #f8fafc;
            padding: 12px;
            border-radius: 6px;
            border: 1px solid #e2e8f0;
            flex: 1;
            overflow: auto;
            margin-bottom: 10px;
        }
        .result-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }
        .result-item {
            background: white;
            padding: 8px;
            border-radius: 4px;
            border-left: 3px solid #2196F3;
        }
        .result-label {
            color: #64748B;
            font-size: 10px;
            margin-bottom: 2px;
        }
        .result-value {
            color: #2196F3;
            font-weight: 600;
            font-size: 12px;
        }
        .result-formula {
            color: #94A3B8;
            font-size: 9px;
            margin-top: 2px;
        }
        .calculate-btn {
            width: 100%;
            padding: 10px;
            background: #2196F3;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            flex-shrink: 0;
        }
        .error-message {
            color: #f44336;
            font-size: 10px;
            margin-top: 4px;
            display: none;
        }
        .toggle-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 8px;
        }
        .hidden {
            display: none;
        }
        .calculator-section {
            display: none;
            flex-direction: column;
            flex: 1;
            overflow: auto;
        }
        .calculator-section.active {
            display: flex;
        }
        .result-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 11px;
            margin-bottom: 12px;
        }
        .result-table th, .result-table td {
            padding: 6px 8px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }
        .result-table th {
            background-color: #f8fafc;
            color: #64748B;
            font-weight: 500;
        }
        .result-table td {
            color: #37474F;
        }
        .highlight {
            color: #2196F3;
            font-weight: 600;
        }
        .unit {
            font-size: 9px;
            color: #888;
            margin-left: 1px;
        }
        .interest-free-section {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #e2e8f0;
        }
        .interest-free-options {
            display: flex;
            gap: 6px;
            margin-bottom: 8px;
        }
        .interest-free-option {
            flex: 1;
            padding: 6px 4px;
            text-align: center;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 11px;
            cursor: pointer;
            background: white;
        }
        .interest-free-option.active {
            background: #2196F3;
            color: white;
            border-color: #2196F3;
        }
        .interest-free-result-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 11px;
        }
        .interest-free-result-table td {
            padding: 6px 8px;
            border-bottom: 1px solid #e2e8f0;
        }
        .interest-free-result-table td:first-child {
            color: #64748B;
            font-size: 10px;
        }
        .interest-free-result-table td:last-child {
            color: #2196F3;
            font-weight: 600;
            text-align: right;
        }
        .actual-free-interest-positive {
            color: #4CAF50 !important;
        }
        .actual-free-interest-negative {
            color: #F44336 !important;
        }
        /* 返点建议样式 */
        .proportional-equation {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #2196F3;
            margin-bottom: 15px;
            text-align: center;
        }
        .equation-title {
            color: #2196F3;
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 20px;
        }
        .fraction-equation {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            margin-bottom: 20px;
            font-size: 18px;
        }
        .fraction-row {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .fraction {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .numerator, .denominator {
            padding: 8px 15px;
            background: #e3f2fd;
            border-radius: 4px;
            min-width: 60px;
            text-align: center;
            position: relative;
        }
        .fraction-line {
            width: 100%;
            height: 2px;
            background: #2196F3;
            margin: 2px 0;
        }
        .equals {
            font-size: 20px;
            font-weight: bold;
            margin: 0 10px;
        }
        .equation-result {
            margin-top: 15px;
            padding: 12px;
            background: #e8f5e8;
            border-radius: 6px;
            border: 1px solid #4CAF50;
        }
        .result-value-large {
            color: #2196F3;
            font-weight: 700;
            font-size: 18px;
            text-align: center;
        }
        .equation-note {
            font-size: 12px;
            color: #666;
            text-align: center;
            line-height: 1.5;
            margin-top: 10px;
        }
        .highlight-number {
            color: #2196F3;
            font-weight: 600;
            background: #e3f2fd;
            padding: 2px 6px;
            border-radius: 3px;
        }
        .rebate-input-label {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        .dynamic-years {
            color: #2196F3;
            font-weight: 600;
        }
        .fraction-label {
            position: absolute;
            left: -15px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 14px;
            font-weight: bold;
            color: #f44336;
        }
        /* 返点建议新增结果区域样式（与利息计算器一致） */
        .rebate-result-wrap {
            background: #f8fafc;
            padding: 12px;
            border-radius: 6px;
            border: 1px solid #e2e8f0;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <div class="calculator-container">
        <div class="header">
            <h1>计算器</h1>
        </div>
        
        <div class="tabs">
            <div class="tab active" data-tab="interest">利息</div>
            <div class="tab" data-tab="annual">年费</div>
            <div class="tab" data-tab="rebate">月厘/返点</div>
        </div>
        
        <div class="calculator-content">
            <!-- 利息计算器 -->
            <div class="calculator-section active" id="interest-calculator">
                <div class="input-section">
                    <div class="input-item">
                        <label for="loanAmount" class="required">贷款金额（元）</label>
                        <input type="number" id="loanAmount" placeholder="输入金额">
                        <button class="clear-btn" data-target="loanAmount">×</button>
                        <div class="error-message" id="loanAmountError">请输入贷款金额</div>
                    </div>
                    <div class="input-item">
                        <label for="monthlyPayment" class="required">月供（元）</label>
                        <input type="number" id="monthlyPayment" placeholder="输入月供">
                        <button class="clear-btn" data-target="monthlyPayment">×</button>
                        <div class="error-message" id="monthlyPaymentError">请输入月供金额</div>
                        <div class="error-message" id="monthlyPaymentLogicError">月供总额不能小于贷款金额</div>
                    </div>
                    <div class="input-item">
                        <label for="loanTerm">贷款期限</label>
                        <select id="loanTerm">
                            <option value="12">1年（12期）</option>
                            <option value="24">2年（24期）</option>
                            <option value="36">3年（36期）</option>
                            <option value="48">4年（48期）</option>
                            <option value="60" selected>5年（60期）</option>
                        </select>
                    </div>
                    <div class="input-item">
                        <label for="rebateRate">返点比例</label>
                        <select id="rebateRate">
                            <option value="0">0%</option>
                            <option value="0.5">0.5%</option>
                            <option value="1">1%</option>
                            <option value="1.5">1.5%</option>
                            <option value="2">2%</option>
                            <option value="2.5">2.5%</option>
                            <option value="3">3%</option>
                            <option value="3.5">3.5%</option>
                            <option value="4">4%</option>
                            <option value="4.5">4.5%</option>
                            <option value="5">5%</option>
                            <option value="5.5">5.5%</option>
                            <option value="6">6%</option>
                            <option value="6.5">6.5%</option>
                            <option value="7">7%</option>
                            <option value="7.5">7.5%</option>
                            <option value="8">8%</option>
                            <option value="8.5">8.5%</option>
                            <option value="9">9%</option>
                            <option value="9.5">9.5%</option>
                            <option value="10">10%</option>
                            <option value="10.5">10.5%</option>
                            <option value="11">11%</option>
                            <option value="11.5">11.5%</option>
                            <option value="12">12%</option>
                            <option value="12.5">12.5%</option>
                            <option value="13">13%</option>
                            <option value="13.5">13.5%</option>
                            <option value="14">14%</option>
                            <option value="14.5">14.5%</option>
                            <option value="15">15%</option>
                            <option value="15.5">15.5%</option>
                            <option value="16">16%</option>
                            <option value="16.5">16.5%</option>
                            <option value="17">17%</option>
                            <option value="17.5">17.5%</option>
                            <option value="18">18%</option>
                            <option value="18.5">18.5%</option>
                            <option value="19">19%</option>
                            <option value="19.5">19.5%</option>
                            <option value="20">20%</option>
                        </select>
                    </div>
                </div>
                
                <div class="result-wrap">
                    <div class="result-grid">
                        <div class="result-item">
                            <div class="result-label">总本息金额</div>
                            <div class="result-value" id="totalPayment">--<span class="unit">元</span></div>
                            <div class="result-formula">月供×期数</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">总利息支出</div>
                            <div class="result-value" id="totalInterest">--<span class="unit">元</span></div>
                            <div class="result-formula">总本息-贷款</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">月利息</div>
                            <div class="result-value" id="monthlyInterest">--<span class="unit">元</span></div>
                            <div class="result-formula">总利息÷期数</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">月供本金</div>
                            <div class="result-value" id="monthlyPrincipal">--<span class="unit">元</span></div>
                            <div class="result-formula">月供-月利息</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">月利率</div>
                            <div class="result-value" id="monthlyRate">--<span class="unit">%</span></div>
                            <div class="result-formula">月利息÷贷款×100%</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">月利息厘数</div>
                            <div class="result-value" id="monthlyLi">--<span class="unit">厘</span></div>
                            <div class="result-formula">月利率÷0.1%</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">年费率</div>
                            <div class="result-value" id="annualFeeRate">--<span class="unit">%</span></div>
                            <div class="result-formula">总利息÷(贷款×年)×100%</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">年利率</div>
                            <div class="result-value" id="annualRate">--<span class="unit">%</span></div>
                            <div class="result-formula">月利率×12</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label" id="nYearRateLabel">5年利率</div>
                            <div class="result-value" id="nYearRate">--<span class="unit">点</span></div>
                            <div class="result-formula" id="nYearRateFormula">总利息÷贷款×100%</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">返点金额</div>
                            <div class="result-value" id="rebateAmount">--<span class="unit">元</span></div>
                            <div class="result-formula">贷款×返点比例</div>
                        </div>
                    </div>
                </div>
                
                <button class="calculate-btn" id="calculateBtn">开始计算</button>
            </div>
            
            <!-- 年费计算器 -->
            <div class="calculator-section" id="annual-calculator">
                <div class="input-section">
                    <div class="input-item">
                        <label for="annualFeeAmount" class="required">贷款金额（元）</label>
                        <input type="number" id="annualFeeAmount" placeholder="输入金额">
                        <button class="clear-btn" data-target="annualFeeAmount">×</button>
                        <div class="error-message" id="annualFeeAmountError">请输入贷款金额</div>
                    </div>
                    <div class="input-item">
                        <label for="annualFeeRateInput" class="required">年费率（%）</label>
                        <input type="number" id="annualFeeRateInput" placeholder="输入费率" step="0.0001">
                        <button class="clear-btn" data-target="annualFeeRateInput">×</button>
                        <div class="error-message" id="annualFeeRateError">请输入年费率</div>
                    </div>
                </div>
                <div class="toggle-row">
                    <div class="input-item">
                        <label for="annualFeeTerm">贷款期限</label>
                        <select id="annualFeeTerm">
                            <option value="12">1年（12期）</option>
                            <option value="24">2年（24期）</option>
                            <option value="36">3年（36期）</option>
                            <option value="48">4年（48期）</option>
                            <option value="60" selected>5年（60期）</option>
                        </select>
                    </div>
                    <div class="input-item">
                        <label for="interestFreeOption">是否支持免息方案</label>
                        <select id="interestFreeOption">
                            <option value="no">不支持</option>
                            <option value="yes">支持</option>
                        </select>
                    </div>
                </div>
                
                <div class="result-wrap">
                    <table class="result-table">
                        <thead>
                            <tr>
                                <th>项目</th>
                               <th>计算方式</th>
                                <th>结果</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>总利息</strong></td>
                                <td id="totalInterestFormula">--</td>
                                <td class="highlight" id="totalInterestResult">--<span class="unit">元</span></td>
                            </tr>
                            <tr>
                                <td><strong>月供本金</strong></td>
                                <td id="monthlyPrincipalFormula">--</td>
                                <td class="highlight" id="monthlyPrincipalResult">--<span class="unit">元</span></td>
                            </tr>
                            <tr>
                                <td><strong>月供利息</strong></td>
                                <td id="monthlyInterestFormula">--</td>
                                <td class="highlight" id="monthlyInterestResult">--<span class="unit">元</span></td>
                            </tr>
                            <tr>
                                <td><strong>月供</strong></td>
                                <td id="monthlyPaymentFormula">--</td>
                                <td class="highlight" id="monthlyPaymentResult">--<span class="unit">元</span></td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <div id="interestFreeResult" class="hidden interest-free-section">
                        <div class="interest-free-options">
                            <div class="interest-free-option active" data-years="1">1年</div>
                            <div class="interest-free-option" data-years="2">2年</div>
                            <div class="interest-free-option" data-years="3">3年</div>
                            <div class="interest-free-option" data-years="4">4年</div>
                            <div class="interest-free-option" data-years="5">5年</div>
                        </div>
                        <table class="interest-free-result-table">
                            <tr>
                                <td id="freeYearInterestLabel">1年利息</td>
                                <td id="freeYearInterest">--<span class="unit">元</span></td>
                            </tr>
                            <tr>
                                <td>返点金额</td>
                                <td id="returnInterest">--<span class="unit">元</span></td>
                            </tr>
                            <tr>
                                <td>实际盈/亏</td>
                                <td id="actualFreeInterest" class="actual-free-interest">--<span class="unit">元</span></td>
                            </tr>
                        </table>
                    </div>
                </div>
                
                <button class="calculate-btn" id="calculateAnnualFeeBtn">开始计算</button>
            </div>
            <!-- 返点建议 -->
            <div class="calculator-section" id="rebate-calculator">
                <div class="input-section">
                    <div class="input-item">
                        <label for="nYearRateInput" class="rebate-input-label">
                            <span id="dynamicYearsLabel" class="dynamic-years">5</span>年利率（点）
                        </label>
                        <input type="number" id="nYearRateInput" placeholder="自动同步或手动输入">
                        <button class="clear-btn" data-target="nYearRateInput">×</button>
                        <div class="error-message" id="nYearRateError">请输入n年利率</div>
                    </div>
                    <div class="input-item">
                        <label for="rebateLoanAmount" class="rebate-input-label">贷款总额（元）</label>
                        <input type="number" id="rebateLoanAmount" placeholder="输入贷款总额">
                        <button class="clear-btn" data-target="rebateLoanAmount">×</button>
                        <div class="error-message" id="rebateLoanAmountError">请输入贷款总额</div>
                    </div>
                    <div class="input-item">
                        <label for="rebateMonthlyLi" class="rebate-input-label">月厘数</label>
                        <input type="number" id="rebateMonthlyLi" placeholder="输入月厘数" step="0.01">
                        <button class="clear-btn" data-target="rebateMonthlyLi">×</button>
                        <div class="error-message" id="rebateMonthlyLiError">请输入月厘数</div>
                    </div>
                    <div class="input-item">
                        <label for="rebateRepaymentPeriod" class="rebate-input-label">还款期数</label>
                        <select id="rebateRepaymentPeriod">
                            <option value="12">1年（12期）</option>
                            <option value="24">2年（24期）</option>
                            <option value="36">3年（36期）</option>
                            <option value="48">4年（48期）</option>
                            <option value="60" selected>5年（60期）</option>
                        </select>
                    </div>
                </div>
                
                <div class="proportional-equation">
                    <div class="equation-title">返点比例计算</div>
                    <div class="fraction-equation">
                        <div class="fraction-row">
                            <div class="fraction">
                                <div class="numerator">
                                    <span class="fraction-label"></span>25
                                </div>
                                <div class="fraction-line"></div>
                                <div class="denominator">
                                   <span class="fraction-label"></span>15
                                </div>
                            </div>
                            <div class="equals">=</div>
                            <div class="fraction">
                                <div class="numerator" id="rightNumerator">--</div>
                                <div class="fraction-line"></div>
                                <div class="denominator">x</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="equation-result">
                        <div class="result-value-large" id="finalResult">x = --</div>
                    </div>
                    
                    <div class="equation-note">
                        <span class="highlight-number">25</span>代表5年利率，
                        <span class="highlight-number">15</span>代表5年建议15点返息<br>
                        当前<span id="currentYearsDisplay">5</span>年利率为<span id="currentRateDisplay">--</span>点，建议返点比例为<span id="suggestedRebateResult">--</span>点
                    </div>
                </div>
                
                <!-- 贷款计算结果区域（含月供总额） -->
                <div class="rebate-result-wrap">
                    <div class="result-grid">
                        <div class="result-item">
                            <div class="result-label">还款总额</div>
                            <div class="result-value" id="rebateTotalPayment">--<span class="unit">元</span></div>
                            <div class="result-formula">贷款总额+总利息</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">总利息</div>
                            <div class="result-value" id="rebateTotalInterest">--<span class="unit">元</span></div>
                            <div class="result-formula">贷款总额×(月厘数÷1000)×期数</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">月利息</div>
                            <div class="result-value" id="rebateMonthlyInterest">--<span class="unit">元</span></div>
                            <div class="result-formula">总利息÷期数</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">月供本金</div>
                            <div class="result-value" id="rebateMonthlyPrincipal">--<span class="unit">元</span></div>
                            <div class="result-formula">贷款总额÷期数</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">月供总额</div>
                            <div class="result-value" id="rebateMonthlyTotal">--<span class="unit">元</span></div>
                            <div class="result-formula">月供本金+月利息</div>
                        </div>
                    </div>
                </div>
                
                <button class="calculate-btn" id="calculateRebateBtn">开始计算</button>
            </div>
        </div>
    </div>
    <script>
        // DOM元素获取
        const tabs = document.querySelectorAll('.tab');
        const interestCalculator = document.getElementById('interest-calculator');
        const annualCalculator = document.getElementById('annual-calculator');
        const rebateCalculator = document.getElementById('rebate-calculator');
        
        // 利息计算器元素
        const loanAmount = document.getElementById('loanAmount');
        const monthlyPayment = document.getElementById('monthlyPayment');
        const loanTerm = document.getElementById('loanTerm');
        const rebateRate = document.getElementById('rebateRate');
        const calculateBtn = document.getElementById('calculateBtn');
        
        // 错误信息元素
        const loanAmountError = document.getElementById('loanAmountError');
        const monthlyPaymentError = document.getElementById('monthlyPaymentError');
        const monthlyPaymentLogicError = document.getElementById('monthlyPaymentLogicError');
        
        // 利息计算结果元素
        const totalPayment = document.getElementById('totalPayment');
        const totalInterest = document.getElementById('totalInterest');
        const monthlyInterest = document.getElementById('monthlyInterest');
        const monthlyPrincipal = document.getElementById('monthlyPrincipal');
        const monthlyRate = document.getElementById('monthlyRate');
        const monthlyLi = document.getElementById('monthlyLi');
        const annualFeeRate = document.getElementById('annualFeeRate');
        const annualRate = document.getElementById('annualRate');
        const nYearRateLabel = document.getElementById('nYearRateLabel');
        const nYearRate = document.getElementById('nYearRate');
        const nYearRateFormula = document.getElementById('nYearRateFormula');
        const rebateAmount = document.getElementById('rebateAmount');
        
        // 年费计算器元素
        const annualFeeAmount = document.getElementById('annualFeeAmount');
        const annualFeeRateInput = document.getElementById('annualFeeRateInput');
        const annualFeeTerm = document.getElementById('annualFeeTerm');
        const interestFreeOption = document.getElementById('interestFreeOption');
        const calculateAnnualFeeBtn = document.getElementById('calculateAnnualFeeBtn');
        
        // 年费错误信息元素
        const annualFeeAmountError = document.getElementById('annualFeeAmountError');
        const annualFeeRateError = document.getElementById('annualFeeRateError');
        
        // 年费计算结果元素
        const totalInterestResult = document.getElementById('totalInterestResult');
        const monthlyPrincipalResult = document.getElementById('monthlyPrincipalResult');
        const monthlyInterestResult = document.getElementById('monthlyInterestResult');
        const monthlyPaymentResult = document.getElementById('monthlyPaymentResult');
        
        // 公式显示元素
        const totalInterestFormula = document.getElementById('totalInterestFormula');
        const monthlyPrincipalFormula = document.getElementById('monthlyPrincipalFormula');
        const monthlyInterestFormula = document.getElementById('monthlyInterestFormula');
        const monthlyPaymentFormula = document.getElementById('monthlyPaymentFormula');
        
        // 免息方案元素
        const interestFreeResult = document.getElementById('interestFreeResult');
        const freeYearInterestLabel = document.getElementById('freeYearInterestLabel');
        const freeYearInterest = document.getElementById('freeYearInterest');
        const returnInterest = document.getElementById('returnInterest');
        const actualFreeInterest = document.getElementById('actualFreeInterest');
        const interestFreeOptions = document.querySelectorAll('.interest-free-option');
        
        // 返点建议元素（含新增）
        const dynamicYearsLabel = document.getElementById('dynamicYearsLabel');
        const nYearRateInput = document.getElementById('nYearRateInput');
        const nYearRateError = document.getElementById('nYearRateError');
        const rightNumerator = document.getElementById('rightNumerator');
        const finalResult = document.getElementById('finalResult');
        const currentYearsDisplay = document.getElementById('currentYearsDisplay');
        const currentRateDisplay = document.getElementById('currentRateDisplay');
        const suggestedRebateResult = document.getElementById('suggestedRebateResult');
        const calculateRebateBtn = document.getElementById('calculateRebateBtn');
        // 新增返点建议输入元素
        const rebateLoanAmount = document.getElementById('rebateLoanAmount');
        const rebateMonthlyLi = document.getElementById('rebateMonthlyLi');
        const rebateRepaymentPeriod = document.getElementById('rebateRepaymentPeriod');
        // 新增返点建议错误信息
        const rebateLoanAmountError = document.getElementById('rebateLoanAmountError');
        const rebateMonthlyLiError = document.getElementById('rebateMonthlyLiError');
        // 新增返点建议结果元素（含月供总额）
        const rebateTotalPayment = document.getElementById('rebateTotalPayment');
        const rebateTotalInterest = document.getElementById('rebateTotalInterest');
        const rebateMonthlyInterest = document.getElementById('rebateMonthlyInterest');
        const rebateMonthlyPrincipal = document.getElementById('rebateMonthlyPrincipal');
        const rebateMonthlyTotal = document.getElementById('rebateMonthlyTotal');
        
        let selectedFreeYears = 1;
        let currentRebateYears = 5; // 默认5年
        // 监听贷款期限变化，同步更新返点建议页面的n值
        loanTerm.addEventListener('change', function() {
            updateNYearRateLabel();
            updateRebateYears();
        });
        // 更新返点建议页面的年份显示
        function updateRebateYears() {
            const termValue = parseInt(loanTerm.value);
            currentRebateYears = termValue / 12;
            
            // 更新返点建议页面的标签
            dynamicYearsLabel.textContent = currentRebateYears;
            currentYearsDisplay.textContent = currentRebateYears;
        }
        // 标签切换
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const tabId = tab.getAttribute('data-tab');
                
                // 移除所有active类
                tabs.forEach(t => t.classList.remove('active'));
                interestCalculator.classList.remove('active');
                annualCalculator.classList.remove('active');
                rebateCalculator.classList.remove('active');
                
                // 添加active类到当前标签
                tab.classList.add('active');
                
                // 显示对应的计算器部分
                if (tabId === 'interest') {
                    interestCalculator.classList.add('active');
                } else if (tabId === 'annual') {
                    annualCalculator.classList.add('active');
                } else if (tabId === 'rebate') {
                    rebateCalculator.classList.add('active');
                    // 切换到返点建议时，自动同步n年利率和更新年份
                    updateRebateYears();
                    syncNYearRateToRebate();
                }
            });
        });
        
        // 同步n年利率到返点建议
        function syncNYearRateToRebate() {
            const nYearRateValue = nYearRate.textContent;
            if (nYearRateValue && nYearRateValue !== '--') {
                const cleanValue = nYearRateValue.replace('--', '').replace('<span class="unit">点</span>', '').trim();
                if (cleanValue && cleanValue !== '--') {
                    // 根据上方显示格式决定输入框格式
                    if (cleanValue.includes('.')) {
                        nYearRateInput.value = parseFloat(cleanValue).toFixed(4);
                    } else {
                        nYearRateInput.value = parseInt(cleanValue);
                    }
                    // 输入时立即更新x上方的值
                    updateRightNumerator();
                }
            }
        }
        
        // 输入时实时更新x上方的值
        nYearRateInput.addEventListener('input', function() {
            updateRightNumerator();
            // 清空x的结果，直到点击计算按钮
            finalResult.textContent = 'x = --';
            suggestedRebateResult.textContent = '--';
        });
        
        // 新增输入框输入事件（清除按钮控制）
        rebateLoanAmount.addEventListener('input', function() {
            const clearBtn = this.nextElementSibling;
            clearBtn.style.opacity = this.value ? '1' : '0';
        });
        rebateMonthlyLi.addEventListener('input', function() {
            const clearBtn = this.nextElementSibling;
            clearBtn.style.opacity = this.value ? '1' : '0';
        });
        
        // 更新x上方的值
        function updateRightNumerator() {
            const nYearRateValue = parseFloat(nYearRateInput.value);
            if (!isNaN(nYearRateValue)) {
                // 根据输入框的值决定显示格式
                let displayValue;
                if (nYearRateInput.value.includes('.')) {
                    displayValue = nYearRateValue.toFixed(4);
                } else {
                    displayValue = nYearRateValue.toString();
                }
                
                // 更新比例方程右侧分子
                rightNumerator.textContent = displayValue;
                currentRateDisplay.textContent = displayValue;
            } else {
                rightNumerator.textContent = '--';
                currentRateDisplay.textContent = '--';
            }
        }
        
        // 返点建议验证（新增空值验证逻辑）
        function validateRebateInputs() {
            resetAllErrors();
            let isValid = true;
            const hasRate = nYearRateInput.value && parseFloat(nYearRateInput.value) > 0;
            const hasLoan = rebateLoanAmount.value && parseFloat(rebateLoanAmount.value) > 0;
            const hasLi = rebateMonthlyLi.value && parseFloat(rebateMonthlyLi.value) > 0;
            
            // 若年利率为空，且贷款总额/月厘数也为空 → 显示三者的错误提示
            if (!hasRate && !hasLoan && !hasLi) {
                nYearRateError.style.display = 'block';
                rebateLoanAmountError.style.display = 'block';
                rebateMonthlyLiError.style.display = 'block';
                isValid = false;
            }
            // 若年利率为空，但贷款总额/月厘数有一个为空 → 显示对应空值的错误提示
            else if (!hasRate && (!hasLoan || !hasLi)) {
                if (!hasLoan) rebateLoanAmountError.style.display = 'block';
                if (!hasLi) rebateMonthlyLiError.style.display = 'block';
                isValid = false;
            }
            // 其他情况（年利率有值，或贷款总额+月厘数有值）→ 验证通过
            else {
                isValid = true;
            }
            
            return isValid;
        }
        
        // 贷款期限变化时更新n年利率标签
        function updateNYearRateLabel() {
            const termValue = parseInt(loanTerm.value);
            const years = termValue / 12;
            nYearRateLabel.textContent = `${years}年利率`;
        }
        
        // 初始化
        updateNYearRateLabel();
        updateRebateYears();
        
        // 免息方案下拉框事件
        interestFreeOption.addEventListener('change', function() {
            if (this.value === 'yes') {
                interestFreeResult.classList.remove('hidden');
            } else {
                interestFreeResult.classList.add('hidden');
            }
        });
        
        // 免息年限选择
        interestFreeOptions.forEach(option => {
            option.addEventListener('click', function() {
                interestFreeOptions.forEach(opt => opt.classList.remove('active'));
                this.classList.add('active');
                selectedFreeYears = parseInt(this.getAttribute('data-years'));
                updateInterestFreeLabels();
                
                // 重新计算免息方案结果
                if (interestFreeOption.value === 'yes') {
                    calculateInterestFree();
                }
            });
        });
        
        // 清除按钮事件（含新增输入框）
        document.querySelectorAll('.clear-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const targetId = this.getAttribute('data-target');
                const input = document.getElementById(targetId);
                if (input) {
                    input.value = '';
                    input.focus();
                    // 触发输入事件以更新清除按钮显示状态
                    input.dispatchEvent(new Event('input'));
                }
            });
        });
        
        // 输入框输入事件，用于控制清除按钮显示
        document.querySelectorAll('input[type="number"]').forEach(input => {
            input.addEventListener('input', function() {
                const clearBtn = this.nextElementSibling;
                if (this.value && clearBtn && clearBtn.classList.contains('clear-btn')) {
                    clearBtn.style.opacity = '1';
                } else if (clearBtn && clearBtn.classList.contains('clear-btn')) {
                    clearBtn.style.opacity = '0';
                }
            });
        });
        
        // 更新免息方案标签
        function updateInterestFreeLabels() {
            freeYearInterestLabel.textContent = `${selectedFreeYears}年利息`;
        }
        
        // 格式化金额显示（保留两位小数）
        function formatCurrency(value) {
            return parseFloat(value).toFixed(2);
        }
        
        // 格式化百分比显示（保留四位小数）
        function formatPercentage(value) {
            return parseFloat(value).toFixed(4);
        }
        
        // 重置所有错误信息
        function resetAllErrors() {
            loanAmountError.style.display = 'none';
            monthlyPaymentError.style.display = 'none';
            monthlyPaymentLogicError.style.display = 'none';
            annualFeeAmountError.style.display = 'none';
            annualFeeRateError.style.display = 'none';
            nYearRateError.style.display = 'none';
            // 新增错误信息重置
            rebateLoanAmountError.style.display = 'none';
            rebateMonthlyLiError.style.display = 'none';
        }
        
        // 利息计算器验证
        function validateInterestInputs() {
            resetAllErrors();
            let isValid = true;
            
            if (!loanAmount.value || parseFloat(loanAmount.value) <= 0) {
                loanAmountError.style.display = 'block';
                isValid = false;
            }
            
            if (!monthlyPayment.value || parseFloat(monthlyPayment.value) <= 0) {
                monthlyPaymentError.style.display = 'block';
                isValid = false;
            }
            
            if (isValid) {
                const loanAmt = parseFloat(loanAmount.value);
                const monthlyPay = parseFloat(monthlyPayment.value);
                const totalMonths = parseInt(loanTerm.value);
                const totalPay = monthlyPay * totalMonths;
                
                if (totalPay < loanAmt) {
                    monthlyPaymentLogicError.style.display = 'block';
                    isValid = false;
                }
            }
            
            return isValid;
        }
        
        // 年费计算器验证
        function validateAnnualFeeInputs() {
            resetAllErrors();
            let isValid = true;
            
            if (!annualFeeAmount.value || parseFloat(annualFeeAmount.value) <= 0) {
                annualFeeAmountError.style.display = 'block';
                isValid = false;
            }
            
            if (!annualFeeRateInput.value || parseFloat(annualFeeRateInput.value) <= 0) {
                annualFeeRateError.style.display = 'block';
                isValid = false;
            }
            
            return isValid;
        }
        
        // 计算免息方案
        function calculateInterestFree() {
            const loanAmt = parseFloat(annualFeeAmount.value);
            const feeRate = parseFloat(annualFeeRateInput.value);
            
            // 1. 返还利息 = 贷款金额 × 利息计算器的返点比例值
            const rebate = parseFloat(rebateRate.value);
            const returnInterestAmt = loanAmt * rebate / 100;
            
            // 2. n年利息 = 贷款金额 × 年费率 × 选择的年限
            const freeYearInterestAmt = loanAmt * feeRate / 100 * selectedFreeYears;
            
            // 3. 实际免息 = 返还利息 - n年利息（保留负数）
            const actualFreeInterestAmt = returnInterestAmt - freeYearInterestAmt;
            
            // 更新页面显示 + 实际免息的颜色
            freeYearInterest.innerHTML = formatCurrency(freeYearInterestAmt) + '<span class="unit">元</span>';
            returnInterest.innerHTML = formatCurrency(returnInterestAmt) + '<span class="unit">元</span>';
            
            // 实际免息颜色处理
            actualFreeInterest.innerHTML = formatCurrency(actualFreeInterestAmt) + '<span class="unit">元</span>';
            actualFreeInterest.classList.remove('actual-free-interest-positive', 'actual-free-interest-negative');
            if (actualFreeInterestAmt > 0) {
                actualFreeInterest.classList.add('actual-free-interest-positive');
            } else if (actualFreeInterestAmt < 0) {
                actualFreeInterest.classList.add('actual-free-interest-negative');
            }
        }
        
        // 利息计算
        calculateBtn.addEventListener('click', function() {
            if (!validateInterestInputs()) return;
            
            const loanAmt = parseFloat(loanAmount.value);
            const monthlyPay = parseFloat(monthlyPayment.value);
            const totalMonths = parseInt(loanTerm.value);
            const termYears = totalMonths / 12;
            const rebate = parseFloat(rebateRate.value);
            
            const totalPay = monthlyPay * totalMonths;
            const totalInterestAmt = totalPay - loanAmt;
            const monthInterest = totalInterestAmt / totalMonths;
            const monthPrincipal = monthlyPay - monthInterest;
            const monthRate = (monthInterest / loanAmt) * 100;
            const monthLi = monthRate / 0.1;
            const annualFee = (totalInterestAmt / (loanAmt * termYears)) * 100;
            const yearRate = monthRate * 12;
            // n年利率计算：总利息 ÷ 贷款金额 × 100%
            const nYearRateValue = (totalInterestAmt / loanAmt) * 100;
            const rebateAmt = loanAmt * rebate / 100;
            
            // 利息计算器结果更新
            totalPayment.innerHTML = formatCurrency(totalPay) + '<span class="unit">元</span>';
            totalInterest.innerHTML = formatCurrency(totalInterestAmt) + '<span class="unit">元</span>';
            monthlyInterest.innerHTML = formatCurrency(monthInterest) + '<span class="unit">元</span>';
            monthlyPrincipal.innerHTML = formatCurrency(monthPrincipal) + '<span class="unit">元</span>';
            monthlyRate.innerHTML = formatPercentage(monthRate) + '<span class="unit">%</span>';
            monthlyLi.innerHTML = formatCurrency(monthLi) + '<span class="unit">厘</span>';
            annualFeeRate.innerHTML = formatPercentage(annualFee) + '<span class="unit">%</span>';
            annualRate.innerHTML = formatPercentage(yearRate) + '<span class="unit">%</span>';
            nYearRate.innerHTML = formatPercentage(nYearRateValue) + '<span class="unit">点</span>';
            nYearRateFormula.textContent = `总利息÷贷款×100%`;
            rebateAmount.innerHTML = formatCurrency(rebateAmt) + '<span class="unit">元</span>';
            
            // 同步到年费计算器的贷款金额和年费率
            annualFeeAmount.value = loanAmt;
            annualFeeRateInput.value = formatPercentage(annualFee);
        });
        
        // 年费计算
        calculateAnnualFeeBtn.addEventListener('click', function() {
            if (!validateAnnualFeeInputs()) return;
            
            const loanAmt = parseFloat(annualFeeAmount.value);
            const feeRate = parseFloat(annualFeeRateInput.value);
            const totalMonths = parseInt(annualFeeTerm.value);
            const termYears = totalMonths / 12;
            
            const totalInterestAmt = loanAmt * feeRate / 100 * termYears;
            const monthPrincipal = loanAmt / totalMonths;
            const monthInterest = totalInterestAmt / totalMonths;
            const monthlyPay = monthPrincipal + monthInterest;
            
            totalInterestResult.innerHTML = formatCurrency(totalInterestAmt) + '<span class="unit">元</span>';
            monthlyPrincipalResult.innerHTML = formatCurrency(monthPrincipal) + '<span class="unit">元</span>';
            monthlyInterestResult.innerHTML = formatCurrency(monthInterest) + '<span class="unit">元</span>';
            monthlyPaymentResult.innerHTML = formatCurrency(monthlyPay) + '<span class="unit">元</span>';
            
            totalInterestFormula.textContent = `=${loanAmt}×${feeRate}%×${termYears}`;
            monthlyPrincipalFormula.textContent = `=${loanAmt}÷${totalMonths}`;
            monthlyInterestFormula.textContent = `=${formatCurrency(totalInterestAmt)}÷${totalMonths}`;
            monthlyPaymentFormula.textContent = `=${formatCurrency(monthPrincipal)}+${formatCurrency(monthInterest)}`;
            
            if (interestFreeOption.value === 'yes') {
                calculateInterestFree();
            }
        });
        
        // 返点建议计算（自动转换月厘数：输入4→0.004）
        calculateRebateBtn.addEventListener('click', function() {
            if (!validateRebateInputs()) return;
            
            const nYearRateValue = parseFloat(nYearRateInput.value);
            const loanAmt = parseFloat(rebateLoanAmount.value) || 0;
            const inputLi = parseFloat(rebateMonthlyLi.value) || 0;
            const monthlyLi = inputLi / 1000; // 核心转换：厘→小数（4厘=4/1000=0.004）
            const repaymentPeriod = parseInt(rebateRepaymentPeriod.value) || 0;
            
            // 1. 计算建议返点比例（原逻辑保留）
            if (nYearRateValue) {
                const baseRate = 25; // 5年基准利率
                const baseRebate = 15; // 5年基准返点
                const suggestedRebate = (nYearRateValue * baseRebate) / baseRate;
                suggestedRebateResult.textContent = suggestedRebate.toFixed(2);
                finalResult.textContent = `x = ${suggestedRebate.toFixed(2)}`;
            } else {
                // 若无年利率，清空返点结果
                finalResult.textContent = 'x = --';
                suggestedRebateResult.textContent = '--';
            }
            
            // 2. 计算贷款多维度结果（自动转换月厘数）
            if (loanAmt && inputLi && repaymentPeriod) {
                const totalInterest = loanAmt * monthlyLi * repaymentPeriod; // 用转换后的小数计算
                const totalPayment = loanAmt + totalInterest; // 还款总额
                const monthInterest = totalInterest / repaymentPeriod; // 月利息
                const monthPrincipal = loanAmt / repaymentPeriod; // 月供本金
                const monthTotal = monthPrincipal + monthInterest; // 月供总额
                
                // 更新结果显示
                rebateTotalPayment.innerHTML = formatCurrency(totalPayment) + '<span class="unit">元</span>';
                rebateTotalInterest.innerHTML = formatCurrency(totalInterest) + '<span class="unit">元</span>';
                rebateMonthlyInterest.innerHTML = formatCurrency(monthInterest) + '<span class="unit">元</span>';
                rebateMonthlyPrincipal.innerHTML = formatCurrency(monthPrincipal) + '<span class="unit">元</span>';
                rebateMonthlyTotal.innerHTML = formatCurrency(monthTotal) + '<span class="unit">元</span>';
            } else {
                // 若贷款总额/月厘数为空，清空贷款结果
                rebateTotalPayment.innerHTML = '--<span class="unit">元</span>';
                rebateTotalInterest.innerHTML = '--<span class="unit">元</span>';
                rebateMonthlyInterest.innerHTML = '--<span class="unit">元</span>';
                rebateMonthlyPrincipal.innerHTML = '--<span class="unit">元</span>';
                rebateMonthlyTotal.innerHTML = '--<span class="unit">元</span>';
            }
        });
    </script>
</body>
</html>